<script>

    function useWorker(func, data, callbackFn) {
        const webWorker = new Worker(URL.createObjectURL(new Blob([`
        self.onmessage = async function(e) {
            const result = await (${func.toString()})(self, e.data);
            self.postMessage(result);
        }
    `], { type: 'application/javascript' })));
        webWorker.onmessage = (e) => {
            callbackFn(e.data)
        };
        webWorker.postMessage(data);
    }

    function useAsyncWorker(func, data) {
        return new Promise((resolve, reject) => {
            useWorker(func, data, (data) => {
                resolve(data)
            })
        })
    }

    async function test() {
        const searchQuery = { value: 123 }
        const paginationSignal = { value: { current: 321 } }
        const performQuery = async (worker, { query, page }) => {
            console.log("Worker: Function Executed")
            worker.postMessage({ success: true })
        }
        // useWorker(performQuery, { query: searchQuery.value, page: paginationSignal.value.current }, (data) => {
        //     console.log(data)
        // })
        let res = await useAsyncWorker(performQuery, { query: searchQuery.value, page: paginationSignal.value.current })
        console.log("res:", res)
    }
    test()
    console.log("END")
</script>